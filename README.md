# ShiftMate
<img src="images/topimage.png" width="600" alt="トップ画像">

## 目次
- [アプリ概要](#アプリ概要)
- [サービスURL](#サービスURL)
- [サービス開発の背景](#サービス開発の背景)
- [ユーザ層について](#ユーザ層について)
- [機能紹介](#機能紹介)
- [技術構成について](#技術構成について)
  - [使用技術](#使用技術)
  - [ER図](#ER図)
  - [画面遷移図](#画面遷移図)
  
  
## アプリ概要
～ 日勤・夜勤の一日のシフト作成アプリケーション ～  
本アプリケーションは、夜勤・日勤スタッフの仮眠・休憩シフトを自動で振り分けできる管理ツールです。    
スタッフや休憩室の条件を設定するだけで、最適なシフトを短時間で作成できます。  
管理者のシフト調整時間を大幅に削減し、管理業務の効率化を実現します。  
  
  
## サービスURL
https://shiftmate-app-f4dad2196d7c.herokuapp.com/
  
  
## サービス開発の背景
私は現在24時間体制の職場で勤めており、日勤や夜勤勤務では複数のスタッフ（約10～20名）と交代で仮眠休憩をとっています。そこでの一日のシフト作成は、管理者が休憩や人員配置のシフト調整を紙に手書きで行っており、作成完了までにかなりの手間や時間を要していました。  
この作成作業をアプリ化することで作成時間や手間を短縮することができると考え、今回の開発に至りました。  
  
  
## ユーザー層について
**医療機関、コールセンター、物流センターなど**  
24時間稼働しており仮眠休憩が交代で必要な職場における、管理者の利用を想定しています。  
  
  
## 機能紹介
### ログイン画面
<img src="images/loginimage.png" width="600" alt="ログイン画像">
「ID」「メールアドレス」「パスワード」「確認用パスワード」を使用してユーザー登録を行います。  
「ID」は社員IDコードなどを想定しています。ログインは「ID」「パスワード」でログイン処理を行います。  
また、Googleアカウントを用いてGoogleログインを行うことも可能としました。  
  
  
### プロジェクト(施設)選択
管理者が複数のプロジェクト(施設)でのシフト作成を行う可能性も考慮し、プロジェクト(施設)を選択するとカレンダーページに遷移します。カレンダーでは日勤と夜勤のシフトの新規作成、作成済シフトの参照を行うことができます。
![プロジェクト選択](https://i.gyazo.com/a99d3fedf842d669966837782c8f52f1.gif)
  
  
### シフト作成：夜勤編
夜勤[ブルー]のアイコンでシフト作成画面へ進みます。シフト作成は2STEPです。
  
1. スタッフ・休憩(仮眠)室選択
勤務スタッフの人数にあった休憩室を選択します。
![デモ](https://i.gyazo.com/e8abd08f7b698ad8488590c5f3fbfb8c.gif)
  
  
2. グループ選択
  
  
3. シフト表示
下記条件を基にシフト自動作成します。
・他のスタッフと同じ時間に休憩室は被らない  
・グループ内のスタッフで休憩時間が被らない  
・深夜帯（0時～6時）で優先的に休憩を配置する  
・深夜帯に入りきらない休憩は深夜帯に近い時間（22時～0時）で配置する  
  
![デモ](https://i.gyazo.com/821460cb0b98e15161d44ef45ad0411b.gif)
  

4. 編集画面
シフト自動作成後に「休憩場所」「休憩開始時間」「コメント」の編集が可能です  
スタッフの希望などに合わせて自由に調整が可能です。  
![デモ](https://i.gyazo.com/bbe658535d43b05a10586453b65e54ef.gif)
  
  
### シフト作成：日勤編
日勤[オレンジ]のアイコンでシフト作成画面へ進みます。シフト作成は2STEPです。  
  
1. スタッフ選択  
![デモ](https://i.gyazo.com/a99d3fedf842d669966837782c8f52f1.gif)
  

2. グループ/休憩希望選択  
![デモ]（https://i.gyazo.com/2d893d4c00fa1a38b91a700ff4000e67.gif）
  
  
3. シフト表示
選択した情報を基にアプリがシフトを自動作成します。  
休憩希望があるスタッフは優先され、希望ないスタッフは同じグループ内で休憩時間の偏りがないように自動配置します。  
表示画面で管理者はシフトを編集可能できます。  
  
![デモ](https://i.gyazo.com/daddba5be3751b430b4dbef82d35a344.gif)
  
  
### シフトの出力
作成したシフトは確定保存され、カレンダーから参照が可能となります。  
また、作成したシフトをPDF出力でき印刷することも可能です。  
  
  
## 技術構成について
### 使用技術
### バックエンド
- Ruby: 3.3.6
- Ruby on Rails: 8.0.2.1
- PostgreSQL(データベース)
- Heroku

### フロントエンド
- HTML/CSS
- Javascript
  - stimulus(シフト手動編集時のUI)
  - Select2(シフト作成時のスタッフ名の検索/複数選択)
 
### gem
- devise:ログイン
- pundit:権限管理
- simple_form
- full_calendar
- kaminari (ページネーション)
- ActionMailer
- wickedPDF (PDF作成)
- SecureRandom (招待機能のToken管理)
- omniauth (google認証)
  
  
  
### ER図
<img src="images/erimage.png" width="600" alt="ER図">
  

### 画面遷移図
Figma： https://www.figma.com/files/team/1541707923313849220/project/439874672/%E5%8D%92%E6%A5%AD%E5%88%B6%E4%BD%9C?fuid=1534487141311269457
  
  
  
  
  
  
## サービスの利用イメージ
- 各勤務帯毎での仮眠休憩シフト配置に特化し、大元となる勤務表は既存することを想定
- 管理者は勤務表から当日の勤務者を選択する
- 役職・勤務時間・休憩室数・小グループ設定などを入力する
　(休憩時間を被らせたくない場合、小グループ化しその間で交代をする)
- アプリが自動で仮眠休憩を割り当て、シフト表を生成する
　(縦軸：スタッフ名、横軸：時間 として労働・仮眠時間、仮眠場所が分かるように出力)
- 管理者は必要に応じて手動で調整できる
- 完成したシフト表をPDF出力し、スタッフに共有できる
- 過去のシフト表はDBに保存され、参照可能
- 施設ごと管理者1人での利用を想定

## ユーザーの獲得について
本サービスは医療機関やコールセンターなど24時間稼働している職場全般で活用可能である。まずは、現在勤務中の職場に業務改善案として本サービス・アプリケーションの導入の提案を行い、使用ユーザーの獲得を目指している。
導入が実現すれば、自分が所属する管理者間で操作頂き使用感や改善点などのフィードバックを募り今度のサービス改善に繋げていく予定。

## サービスの差別化ポイント・推しポイント
- 仮眠休憩に特化している点
  一般的なシフト作成アプリケーションは月間や週間などの全体的な勤務を管理するが、本サービスは"仮眠休憩"に特化
- 詳細な設定が可能な点
  「役職ごとの条件」「勤務帯ごとの小グループ設定」「複数の休憩室対応」など現場で実際に困っている細かいルールに対応する。
  市販のシフト管理アプリではカスタマイズしづらい部分を反映できる。
- 自動化と手動調整が可能な点
  シフト生成を自動化し、手動調整も行えるようにすることで人間的な配慮も可能とする
- データ保存・参照が可能な点
  過去のシフトをDBに保存することで、過去の休憩割り当てや記録を確認するニーズも対応
- 複数の施設のシフト作成が可能な点
  一人の管理人が複数の施設のシフトを担当する、複数の管理人が一つの施設のシフト作成を担当することも可能とする

- 日勤版のシフト作成が可能な点 (new)
  これまでの夜勤版だけではなく日勤版のシフト作成機能を追加
  日勤(9時～18時、休憩：1時間)とし、日勤ならではの条件も選択できるようにし機能をアップデート

## 機能候補
### MVPリリース時に作っていたいもの
- 勤務者の登録と管理(名前、役職、権限)
- シフト作成（勤務者、勤務時間を選択）
- 条件設定(休憩室、小グループ)
- 入力条件に基づき休憩時間、配置を自動作成
- シフト表のタイムライン式表示（縦軸:スタッフ名、横軸:時間軸）
- シフト編集機能（個々の勤務時間、休憩時間、休憩室をプルダウン式で編集可能）
- DBに保存しカレンダー式で履歴を参照できる
- 施設ごとのシフトをprojectsとし、usersとprojectsの間にuser_projectsとなる中間テーブルを設定する

### シフト自動作成のロジックについて
＜夜勤＞
- ユーザーが設定する条件
  - シフトメンバーと人数
  - 休憩場所と数
  - 小グループ分け

- 制約条件
  - 休憩時間は2時間固定
  - 小グループ内で休憩時間が重ならないように配置（できるだけ）
  - 同じ時間で休憩場所は被らないように配置
  - 夜勤18時~9時の間、0時～6時は優先的に休憩を割り当てる

- 自動割り当てアルゴリズム概要
  - 夜勤時間をスロット化、0~6時を優先順序の先頭に配置する
  - 優先スロットから順番に空き時間を確認、小グループと休憩場所の重複を避け割り当て

＜日勤＞
- ユーザーが設定する条件
  - シフトメンバーと人数
  - 小グループ分け
  - 休憩時間の希望(早め[11~12時]中間[12~13時]遅め[13~14時])

― 制約条件
  - 休憩時間は1時間固定
  - 休憩時間の希望は最優先する
  - 希望がないスタッフは小グループ内で休憩に偏りがないよう自動分配する
  
### 本リリースまでに作っていたいもの
- 作成したシフトをPDF化し印刷対応可能にする
- 履歴参照画面 (カレンダー表示にし過去はPDF表示,未来は編集画面へ遷移)
- 日勤版のシフト作成
- レスポンシブ対応

## 機能の実装方針予定
### バックエンド
- Ruby: 3.3.6
- Ruby on Rails: 8.0.2.1
- PostgreSQL(データベース)
- Heroku

### フロントエンド
- HTML/CSS
- Javascript
  - stimulus(シフト手動編集時のUI)
  - Select2(シフト作成時のスタッフ名の検索/複数選択)
 
### gem
- devise:ログイン
- pundit:権限管理
- simple_form
- full_calendar
- kaminari (ページネーション)
- ActionMailer
- wickedPDF (PDF作成)
- SecureRandom (招待機能のToken管理)
- omniauth (google認証)



### 画面遷移図
Figma：https://www.figma.com/files/team/1541707923313849220/project/439874672/%E5%8D%92%E6%A5%AD%E5%88%B6%E4%BD%9C?fuid=1534487141311269457

### READMEに記載した機能
- [x] ユーザー登録機能(divise)
- [x] ログイン機能
- [x] シフト自動作成機能
- [x] シフト手動編集機能
- [x] グループ分け機能
- [x] パスワード変更機能
- [x] メールアドレス変更機能
- [x] スタッフ検索機能
- [x] ページネーション
- [x] 日勤シフト作成機能追加


### 未ログインでも閲覧または利用できるページ
- 未ログインでも利用できるページは存在しない(全機能ログイン必須)
